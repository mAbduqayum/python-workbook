name: Sync Questions to Solutions Branch

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  sync-solutions:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    permissions:
      contents: write
      actions: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Fetch full history for rebase

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Check if solutions branch exists
        id: check-branch
        run: |
          if git show-ref --verify --quiet refs/remotes/origin/solutions; then
            echo "exists=true" >> $GITHUB_OUTPUT
          else
            echo "exists=false" >> $GITHUB_OUTPUT
          fi

      - name: Create solutions branch if it doesn't exist
        if: steps.check-branch.outputs.exists == 'false'
        run: |
          git checkout -b solutions
          git push -u origin solutions

      - name: Sync questions to solutions branch
        if: steps.check-branch.outputs.exists == 'true'
        run: |
          # Switch to solutions branch
          git checkout solutions

          # Try fast-forward merge first (clean like rebase)
          if git merge --ff-only origin/main; then
            echo "‚úÖ Fast-forward merge successful"
          else
            # Fall back to regular merge if needed
            echo "‚ö†Ô∏è Fast-forward not possible, using regular merge"
            git merge origin/main
          fi

          # Push changes (no force needed!)
          git push origin solutions

      - name: Report sync status
        run: |
          echo "‚úÖ Questions successfully synced to solutions branch"
          echo "üìã Latest commits:"
          git log --oneline -5
