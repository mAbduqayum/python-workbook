name: Sync Questions to Solutions Branch

on:
  push:
    branches: [main]
  workflow_dispatch:

# Prevent concurrent runs for the same branch, canceling older runs.
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: false # default

jobs:
  sync-solutions:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' && github.event.repository.fork == false
    permissions:
      contents: write
      actions: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Fetch full history for git operations

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Sync main branch to solutions branch
        run: |
          set -ex # Exit on error, print commands

          # Check if the solutions branch exists on the remote
          if git show-ref --verify --quiet refs/remotes/origin/solutions; then
            echo "âœ… Solutions branch found on remote, syncing..."
            git checkout solutions
            git merge origin/main
            echo "âœ… Merged latest changes from main"
          else
            echo "ðŸ†• Solutions branch not found on remote, creating..."
            # Create the solutions branch from the current state of main
            git checkout -b solutions
            echo "âœ… Created new solutions branch"
          fi

          # Push the changes to the solutions branch
          echo "ðŸ“¤ Pushing updates to solutions branch..."
          git push origin solutions
          echo "âœ… Solutions branch successfully updated"

      - name: Report sync status
        run: |
          echo "âœ… Questions successfully synced to solutions branch"
          echo "ðŸ“‹ Latest commits on solutions branch:"
          git log --oneline -5
